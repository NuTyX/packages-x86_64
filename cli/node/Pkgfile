description="Evented I/O for V8 JavaScript"
url="http://nodejs.org/"

packager="spiky <spiky@nutyx.org>"
contributors="Alienus, spiky, Greg, tnut"

makedepends=(python c-ares icu zlib libuv nghttp2)

name=node
alias=(nodejs node-js)
version=16.4.2

source=(v8-call-new-ListFormatter-createInstance.patch
	https://nodejs.org/dist/v$version/node-v$version.tar.xz)
prepare() {
  cd node-v$version
#  patch -Np1 -d deps/v8 <../v8-call-new-ListFormatter-createInstance.patch
}
build() {

	cd node-v$version

	./configure \
		--prefix=/usr \
		--shared-zlib \
		--shared-libuv \
		--shared-openssl \
		--shared-cares \
		--shared-nghttp2 \
		--with-intl=system-icu

	make
	make DESTDIR=$PKG install

	# clean up
	find $PKG -type f \( \
		-name 'README.md' -o \
		-name 'AUTHORS.md' -o \
		-name 'INSTALL.md' -o \
		-name 'TODO.org' -o \
		-name 'ChangeLog' -o \
		-name 'NEWS' \) -delete

}
uptodate() {
url+="dist/latest/"
lynx -read_timeout=20 -dump -listonly -nonumbers \
$url|tail -1|sed -e "s@$url$name-v@@" -e "s@.tar.xz@@"
}
