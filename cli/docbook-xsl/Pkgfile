description="XML stylesheets for Docbook-xml transformations"
url="http://scrollkeeper.sourceforge.net/docbook.shtml"

licence="custom"

packager="tnut <tnut@nutyx.org>"
contributors="Pierre B"

makedepends=(libxml2 docbook-xml)

alias=(docbook-xsl-nons)

name=docbook-xsl
version=1.79.2
release=3

source=(stackfix-1.patch
   https://github.com/docbook/xslt10-stylesheets/releases/download/release/$version/$name-$version.tar.bz2
   https://github.com/docbook/xslt10-stylesheets/releases/download/release/$version/$name-nons-$version.tar.bz2
   https://github.com/docbook/xslt10-stylesheets/releases/download/release/$version/docbook-xsl-doc-$version.tar.bz2)

prepare() {

 cd $name-$version
 patch -Np1 -i ../stackfix-1.patch

 cd ../$name-nons-$version
 patch -Np1 -i ../stackfix-1.patch

}
build() {

  local pkgroot ns dir
  for ns in -nons ''; do
     pkgroot="$PKG/usr/share/xml/docbook/xsl-stylesheets-$version$ns"
     dir=$name$ns-$version

     install -Dt "$pkgroot" -m644 $dir/VERSION{,.xsl}

     (
       shopt -s nullglob  # ignore missing files
       for fn in assembly common eclipse epub epub3 fo highlighting html \
         htmlhelp javahelp lib manpages params profiling roundtrip template \
         website xhtml xhtml-1_1 xhtml5
       do
         install -Dt "$pkgroot/$fn" -m644 $dir/$fn/*.{xml,xsl,dtd,ent}
       done
    )
  done

  install -d $PKG/etc/xml
  install -Dt "$PKG/usr/share/licenses/$name" -m644 $dir/COPYING
}
