Submitted By:            Xi Ruoyao <xry111 at xry111 dot site>
Date:                    2023-05-14
Initial Package Version: 102.12.0esr
Upstream Status:         Applied for nightly, but not ESR
Origin:
 - The first patch comes from
   - https://github.com/rust-lang/rust-bindgen/pull/2319
   - https://github.com/rust-lang/rust-bindgen/pull/2339
   And they are integrated into mozilla at
   - https://hg.mozilla.org/mozilla-central/rev/bd3481bf45fb
 - The second patch comes from
   - https://hg.mozilla.org/mozilla-central/rev/61f052c26dd1
   - https://hg.mozilla.org/mozilla-central/rev/9fffd4b92c43
 - The third patch comes from
   - https://hg.mozilla.org/mozilla-central/rev/1a15f95b880f
 - The fourth patch comes from
   - https://github.com/mozilla/mp4parse-rust/commit/8d58b2d5fc7f
   And it's integrated into mozilla at
   - https://hg.mozilla.org/mozilla-central/rev/a651d4323066
   A hack is added for Cargo.{toml,lock} to suppress sha256 check

Description:             The first patch updates the bundled rust-bindgen
                         crate to be compatible with Clang/LLVM 16.
                         Without this patch, you will encounter "not a valid
                         Ident" errors when building Firefox, and it will
                         come out of fallback.rs in proc-macro2. This
                         references mfbt/Vector.h (symlinked to 
                         firefox-build-dir/dist/include/mozilla/Vector.h) in
                         it's error output, but it is because LLVM changed
                         how it reports anonymous items.

                         The second patch adds missing "#include <cstdint>"
                         for three C++ headers and source files.  Without
                         this patch, it will fail to build with C++ headers
                         from GCC 13.

                         The third and fourth patches work around build
                         failures with Rustc-1.70.0.

From 2c22f8cc4756d3e492fe6be4be634fb592b4b0e3 Mon Sep 17 00:00:00 2001
From: Xi Ruoyao <xry111@xry111.site>
Date: Sun, 14 May 2023 03:37:04 +0800
Subject: [PATCH 2/4] add missing <cstdint>

---
 dom/media/webrtc/sdp/RsdparsaSdpGlue.cpp               | 1 +
 gfx/2d/Rect.h                                          | 1 +
 toolkit/components/telemetry/pingsender/pingsender.cpp | 1 +
 3 files changed, 3 insertions(+)

diff --git a/dom/media/webrtc/sdp/RsdparsaSdpGlue.cpp b/dom/media/webrtc/sdp/RsdparsaSdpGlue.cpp
index 8c8a0369c3..d43b4a1e0d 100644
--- a/dom/media/webrtc/sdp/RsdparsaSdpGlue.cpp
+++ b/dom/media/webrtc/sdp/RsdparsaSdpGlue.cpp
@@ -3,6 +3,7 @@
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this file,
  * You can obtain one at http://mozilla.org/MPL/2.0/. */
+#include <cstdint>
 #include <string>
 
 #include "sdp/RsdparsaSdpInc.h"
diff --git a/gfx/2d/Rect.h b/gfx/2d/Rect.h
index 4875ad6714..f52437bbdc 100644
--- a/gfx/2d/Rect.h
+++ b/gfx/2d/Rect.h
@@ -15,6 +15,7 @@
 #include "mozilla/Maybe.h"
 
 #include <cmath>
+#include <cstdint>
 
 namespace mozilla {
 
diff --git a/toolkit/components/telemetry/pingsender/pingsender.cpp b/toolkit/components/telemetry/pingsender/pingsender.cpp
index 01fdb63c29..ceda3b1945 100644
--- a/toolkit/components/telemetry/pingsender/pingsender.cpp
+++ b/toolkit/components/telemetry/pingsender/pingsender.cpp
@@ -3,6 +3,7 @@
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
+#include <cstdint>
 #include <cstdlib>
 #include <cstring>
 #include <ctime>
-- 
2.40.1

# HG changeset patch
# User Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date 1682520906 0
# Node ID 1a15f95b880f3d4b5a427c750932c53a01b4897a
# Parent  17ea6f29654b2ff39d374073cec3e7116c1ec548
[PATCH 3/4] Bug 1829964 - Allow ambiguous glob reexports for now in autogenerated bindings. r=glandium

I started looking into removing these glob re-exports, but I couldn't
convince myself that the result was particularly better...

Differential Revision: https://phabricator.services.mozilla.com/D176473

diff --git a/layout/style/ServoBindings.toml b/layout/style/ServoBindings.toml
--- a/layout/style/ServoBindings.toml
+++ b/layout/style/ServoBindings.toml
@@ -35,16 +35,17 @@ headers = [
     "mozilla/SizeOfState.h",
     "nsCSSProps.h",
     "nsMappedAttributes.h",
     "nsNameSpaceManager.h",
 ]
 raw-lines = [
     # FIXME(emilio): Incrementally remove these "pub use"s. Probably
     # mozilla::css and mozilla::dom are easier.
+    "#[allow(unknown_lints, ambiguous_glob_reexports)]",
     "pub use self::root::*;",
     "pub use self::root::mozilla::*;",
     "pub use self::root::mozilla::css::*;",
     "pub use self::root::mozilla::dom::*;",
 ]
 hide-types = [
     ".*char_traits",
     ".*incompatible_char_type",
