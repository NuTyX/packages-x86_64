description="Libraries used for creating graphical user interfaces for applications."
url="http://www.gtk.org/"

packager="tnut <tnut@nutyx.org>"
contributors="Pierre,Greg,Minzord,Spiky"

makedepends=(python meson ninja iso-codes docbook-xsl libxslt glib
             gtk-doc libepoxy xorg-libxinerama xorg-libxrandr
             xorg-libxcursor cups colord xorg-libxi
             cairo pango gdk-pixbuf wayland-protocols libxkbcommon)
run=(xcursor-dmz adwaita-icon-theme dejavu-ttf gtk-update-icon-cache)

name=gtk3
version=3.24.41

source=(settings.ini.example consolidate.patch
        https://download.gnome.org/sources/gtk+/${version%.*}/gtk+-$version.tar.xz)
prepare() {
cd gtk+-$version
#patch -Np1 -i ../consolidate.patch
}

build() {
mkdir build
cd    build

meson setup --prefix=/usr \
--buildtype=release       \
--sysconfdir=/etc         \
-Dbroadway_backend=true   \
-Dcolord=yes         \
-Dgtk_doc=false      \
-Dman=false          \
-Dintrospection=true \
../gtk+-$version

ninja

DESTDIR=$PKG ninja install

install -m644 ../settings.ini.example $PKG/etc/gtk-3.0/settings.ini.example

# Empaquet√© ds gtk-update-icon-cache
rm $PKG/usr/bin/gtk-update-icon-cache

# As long man page generation is broken
# rm $PKG/usr/share/man/man1/gtk-update-icon-cache.1
}
uptodate(){
local latest lastversion url
url="https://download.gnome.org/sources/gtk+"
latest="`lynx -read_timeout=20 -dump -listonly -nonumbers \
$url/?C=N\;O=D|grep [0-9]/$|head -1`"
lastversion="`lynx -read_timeout=20 -dump -listonly -nonumbers \
$latest/?C=N\;O=D|grep LATEST|grep [0-9]$|cut -d "-" -f3`"
echo "$lastversion"
}
